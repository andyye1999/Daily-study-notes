# 2.5.2 STFT的不同解释
P40  
傅里叶变换解释：滑动窗 对加窗信号的傅里叶变换
滤波操作：

# 5.2谱减法的几何分析
P100
信噪比足够高的情况下，使用带噪相位代替纯净信号相位是安全的
# 5.3 谱减法的缺点
## 音乐噪声
音乐噪声：由半波整流引入的噪声 半波整流：谱减法出现负值则为0 这样对负值的非线性处理会导致频谱的随机位置出现小的，独立的峰值 转换到时域以后，这些峰值听起来就像帧与帧之间频率随机变化的多频音（Tones)，也就是以分析帧速率（每20～30ms）不断开关的多频音。

谱减法的另外一个相对较小的缺点是使用带噪信号相位，因此可能产生比较粗糙的合成语音质量。带噪信号相位与调整以后的频谱相结合以产生增强的时域信号，在此之后才可能得到增强的信号相位。这是由于相位噪声对语音质量的影响并不是太大，尤其是在高信噪比(>5dB）的时候。在低信噪比（<0dB）的时候，带噪相位会导致语音信号变得粗糙,并达到可能被听觉所感知的程度，进而降低语音质量。文献[8，12]中的实验证实了这一结论。要估计纯净语音的相位很困难，并将极大地增加增强算法的复杂度。与幅度谱噪声相比，相位噪声带来的语音失真并不是很大，尤其是在高信噪比条件下。正如在5.2节中所提到的，在谱信噪比较大的时候，带噪相位不能被感知到。简而言之，在增强语音信号的重构过程中，使用带噪信号相位.信息被认为是一个可以接受的方案。

# 7.统计模型 MMSE方法


## mmse与维纳滤波区别
维纳滤波器是在信号的**复频谱**生成一个**线性**估计器
mmse是基于信号**幅度**的统计模型的**非线性**估计，基于语音存在概率的增益修正
![image](https://cdn.jsdelivr.net/gh/andyye1999/image-hosting@master/20221010/image.2kh2fixnsgs.webp)
![image](https://cdn.jsdelivr.net/gh/andyye1999/image-hosting@master/20221010/image.23864srvc8lc.webp)
![image](https://cdn.jsdelivr.net/gh/andyye1999/image-hosting@master/20221010/image.1oi8ja3ml17k.webp)
![image](https://cdn.jsdelivr.net/gh/andyye1999/image-hosting@master/20221010/image.7adrlr4rjh80.webp)
![image](https://cdn.jsdelivr.net/gh/andyye1999/image-hosting@master/20221010/image.5t7mk00mtfo0.webp)
![image](https://cdn.jsdelivr.net/gh/andyye1999/image-hosting@master/20221010/image.73u54kw9v740.webp)
![image](https://cdn.jsdelivr.net/gh/andyye1999/image-hosting@master/20221010/image.36yr51cesvy0.webp)
# 7.3.3.2 引导判决法
P202
先验SNR估计方法

# 9.2 噪声估计算法
## [语音增强原理之噪声估计](https://www.cnblogs.com/icoolmedia/p/noise_estimate.html)
## [噪声估计](https://www.jianshu.com/p/26e24bbc2358)
## [噪声估计方法总结（一）](https://blog.csdn.net/suijue9389/article/details/120628626)
## [几种常用的噪声估计算法（一）](https://blog.csdn.net/weixin_43749411/article/details/120175174)

平滑：减少音乐噪声

P354
基于以下几种
现象一:在闭塞音闭合段，频谱能量趋于零或接近噪声水平，但这不是语音中仅有的无声段。“安静的”信号段在语音活动期间也会发生，特别是:
在清摩擦音期间的低频带，尤其是低于2kHz的频段。
在元音或通常情况下浊音(半元音、鼻音）期间的高频带，4kHz以上。
由于语音信号的以上性质，噪声对语音频谱的影响在频率上并不是均匀分布的。因此，频谱上不同的**频带具有很不同的SNR**。例如，如果噪声具有低通特性（例如汽车噪声)，则频谱的高频区域受到的影响最小，而低频区域受到的影响最大。从而，通过带噪谱的高频区域所提取出的信息可以更可靠地估计和更新噪声谱。更一般的说，对于任何类型的噪声，**我们可以估计和更新单个频带的噪声谱，只要该频带无语音的概率很高**，或者说该频带的实际SNR很低。这产生了**递归平均**噪声估计
现象二:即使是在语音活动期间，带噪语音信号在**单个频带的功率**通常会衰减到噪声的功率水平。由此，我们通过追踪短时窗（0.4～1s）内**带噪语音谱每个频带的最小值**，便可以得到各频带内噪声水平的估计值。由于最小值总是小于平均值，所以噪声估计总是偏向于趋近较小的值。该现象导致**最小值跟踪（ minima-tracking）算法**的出现。
现象三:**每个频带能量的直方图**( histogram）显示，出现**频率最高**的值（即，直方图最大值）对应于特定频带的噪声水平。有些情况下，谱能量的直方图包括两种模式: （a)低能量模式对应于无声段以及语音的低能量段，(b）高能量模式对应于（带噪）语音的浊音段。低能量模式会大于（即出现更频繁）高能量模式。外而，该图形并非总是这个样子，它还取决于所考察的频带、信号的时长以及噪声的类型。我们的仿真表明，典型情况下**直方图在低频具有双峰分布 (bimodal)，中频到高频为单峰**(monomodal)。以上现象，即**每个频带的能量直方图的最大值对应于该频带的噪声水平**，启发人们开发了基于直方图的噪声估计算法。基于顺序统计量(order statistics）的算法也是源于以上现象。
以上三个现象产生了三类主要的噪声估计算法:
1.最小值跟踪算法;
2.时间递归平均算法;
3.基于直方图的算法。

所有算法均按以下方式来操作。首先，基于短交叠的分析帧得到短时谱
典型窗长为20 ~ 30ms，邻帧之间50%交叠。然后，几个连续帧组成一个 我们所称的分析段( analysissegment)，将其用于计算噪声谱。该分析段的典型时间跨度范围可能为400ms到1s之间。
噪声估计算法基于以下假设:
1.分析段足够长，以包括语音间隙和低能量段。
2.分析段中的噪声比语音更平稳，即噪声变化速率比语音慢。
以上假设对分析段的持续时长提出了一对矛盾的要求。分析段需要足够长，以包括语
音间隙和低能量段，但是它也需要足够短，以便跟踪噪声水平的快速变化。最终，选择分
析段的长短需要在两者间进行折衷。
# 9.3 最小值跟踪算法

之前我们提到，**最小值跟踪算法是基于这样一个假设，即哪怕在语音活动期间，单个
频带的带噪语音信号功率通常都会衰减到噪声的功率水平。因此，通过在每个频带跟踪带
噪语音功率的最小值，我们可以得到该频带噪声水平的一个粗略估计**。对此提出了两种不
同的噪声估计算法，第一个算法称为最小值统计( minimum statistics) 算法，它在
一个有限长窗(分析段)之内跟踪带噪语音功率谱的最小值;而第二个算法同样是跟踪最
小值，但是不需要加窗。
由于周期图|Y(),k)"随时间**波动很快，因此更多的是采用一-阶递归**的 周期图:
P(n,k)= aP(h-1,k)+(1- a)|Y(),k)|
其中a为平滑常数。**很容易看出以上的递归方程是一一个IIR低通滤波器，它能对周期图
|Y(2,k)"进行平滑**。我们可以在有限长窗之内跟踪P(2,k)的最小值，从而得到噪声功率谱
的估计。

# 9.4 噪声估计的时间递归平均算法
时间递归平均( time-recursive averaging）算法利用了噪声一般对**语音频谱具有不均匀**影响这一现象，即有些频谱区域受噪声影响比其他一些区域所受影响更大。不同频谱的分量极有可能具有不同的实际SNR。因此，在某一特定频带的实际SNR很低的时候，我们可以对噪声谱按频带来进行估计和更新。同样的，当某一特定频带存在语音的概率较低的时候我们可以更新单个频带的噪声谱。以上分析衍生出了递归平均型的算法，该算法中，**噪声谱估计的计算是基于过去的噪声估计与当前带噪语音谱的加权平均。权重会根据每个频点的实际SNR或者语音的存在概率来自适应的改变。**
本节中介绍的所有时间递归算法具有以下通用形式:
P371
(入,k)=α(入,k)后(入—1,k)+(1-α(入,k))| Y(A,k)|
其中|Y(A,k)是带噪语音幅度谱的平方（周期图)，(入,k)表示第礼帧的频点k处的噪声功率谱密度估计，α(入,k)为与时间和频率相关的平滑因子。不同的算法对平滑因子a(2,k)具有不同的计算方式。一些算法是基于对每一频点所估计的 SNR来计算a(A,k ) ，其他一些算法是基于频点k 处语音的存在概率或不存在概率来计算α(入,k) ，这两类方法在概念上类似。还有一些算法使用固定的α(A,k)，但是只有在满足特定条件的情况下才更新.(入.k )
式表示的递归算法可以做如下解释:如果存在语音，则**后验估计n;()为大值**(如图9.12)，因此α(A,k)~1 ;由于α(入,k) s约等于 1 ，进而我们根据式(9.26）可以得到(入,k) ~6(入-1,k)。也即是说，**此时噪声更新会暂停，噪声估计会保持前一帧的估计值**。相反，如果不存在语音，则后验估计y,(A)为小值（如图 9.12)，因此α(2,k)~0，所以(入,k)s|Y(a,k)。也就是说，**没有语音的时候，噪声估计会紧跟带噪谱的功率谱密度变化**。相对于使用固定的α(A,k)，使用式(9.27）或式(9.29)的时间平滑因子的主要优点在这些平话因子与时间和频率有关于这些平滑因子与时间和频率相关。这意味着噪声功率谱密度会根据不同频点的后验信噪比γe(2)的估计，在不同的频点以不同的速率做自适应。这特别适用于加性噪声为有色噪声的情况。
## 9.4.3 基于信号存在概率的递归平均算法 MCRA


#### [MCRA](https://www.cnblogs.com/talkaudiodev/p/15703937.html) OMLSA MCRA原理


### 求带噪语音功率谱密度时在频点上加窗

在MCRA算法中，对于每个频率点，都会估计它的噪声功率谱密度。由于语音信号在频域上具有局部性，即相邻的频率点之间可能具有相似的信号特性，因此在MCRA算法中，可以采用加窗的方法来平滑估计出的噪声功率谱密度，以提高估计的准确性和鲁棒性。

具体来说，在MCRA算法中，对于每个频率点k，估计其带噪语音功率谱密度P(k)时，会考虑其相邻的L个频率点的带噪语音功率谱密度，即P(k-L), P(k-L+1), ..., P(k-1), P(k), P(k+1), ..., P(k+L-1), P(k+L)，并对它们进行加窗平均，得到平滑后的带噪语音功率谱密度。

P384
MCRA算法:
步骤一:利用式(9.55) 计算平滑带噪语音功率谱密度S(A,k)。
步骤二:利用式(9.23)对S(2,k)进行最小值跟踪以得到Sm (2,k)
步骤三:利用式(9.58)计算p(2,k)，以及使用式(9.59) 对p(2,k)进行时域平滑。
步骤四:利用式(9.59) 得到的平滑条件概率p(2,k)，计算式(9.54) 的时频相关平滑
因子a(),k)。
步骤五:利用式(9.53) 更新噪声功率谱密度of(n,k)。
### 改进的MCRA  IMCRA

自己根据matlab编程实现，但效果不如matlab版本，感觉在帧数更新部分做的不好，语音损失比较大。
原理可在课本上找到，相比MCRA，在语音概率上进行改进



# 9.5 直方图
P393
该技术的最基本方法大多是基于过去功率谱值的直方图来得到噪声估计l201。也就是说，
对新进的每一-帧，我们首先在几百毫秒的时间窗上构建一个功率谱值的直方图，然后将对
应于直方图上最大值的功率值作为噪声谱的估计值(如图9.26示例)。每个频点分别进行以
上处理。也可以对噪声谱估计进行一-阶递归平滑，以虑除估计中出现的离群值。
直方图方法概述如下:
对每- -帧λ，执行:
步骤一:计算带噪语音功率谱|Y(2,k)。
步骤二:使用一阶递归操作平滑带噪功率谱密度:
S(A,k)=aS(A-1,k)+(1- a)|Y(n,k)P
其中a为平滑常数。
步骤三:计算前续D帧的功率谱密度估计S(n,k) {S(h-I,k),S(λ- 2,k)..,S(A- D,k)}的直方图，箱体(bin) 数量采用，例如40个。
步骤四:令c= [,",Cao]为直方图的40个箱体的计数值，s=[s,5s,-,s4]表示对应
的直方图箱体的中心值。令cmax 为最大计数值的序号，即cmx = argmaxc。则将对应于直方
I≤i≤40图最大值的值作为噪声功率谱密度估计(表示为Hmx (2,k) )，即Hmx (A,k)=s(Cmax)。
步骤五:使用一阶递归操作平滑噪声估计H (2,k)
(2,k)=a, ,6f(x-1,k)+(1-a,)Hm (),k)
其中og(n,k)为噪声功率谱密度的平滑估计，axm 为平滑常数。
# 9.6 分位数估计
P399
基于分位数的算法: 
对帧元，执行:
步骤--:对带噪语音的前续D帧功率谱估计:
{|Y(a- I,k)P,IY(-2,k)P,,|Y(A-D-1,.h)1}
进行**排序**。
	步骤二:选取功率谱密度估计的**中值**作为噪声估计。
如图9.33所示展示了使用以上基于中值的噪声估计算法得到的噪声功率谱密度估计，
D对应于400ms和800ms。可以看到，窗长度(D)会影响噪声估计精度，这与直方图方法
的情况很类似(如图9.30所示)。短窗可能导致噪声的过估计，特别是在语音能量跨度较宽
的低频带。如图9.33所示，使用更长的窗口，可能减少噪声过估计的情况。

# OMLSA-IMCRA
## [基于MCRA-OMLSA的语音降噪(一)：原理](https://www.cnblogs.com/talkaudiodev/p/15703937.html)  这个是MCRA不是IMCRA写的不对

### expint 计算指数积分
[指数积分c语言代码](https://github.com/ctwgL/Study_Note/blob/master/OP_ExpInt_Gammainc/expint_demo/expint.c)
[expint和gammainc的C实现](https://mp.weixin.qq.com/s/FIyYbW9Genqi-nmaQL9NRw)
代码放在OMLSA文件夹下面了
比如webrtc，可以改的参数有很多，比如FFT，比如平滑参数，比如VAD门限。
**如何判断噪声估计是否准，可以加入均值方差已知的高斯白噪声来看估计的噪声准不准**

## [OMLSA算法推导](https://zhuanlan.zhihu.com/p/420362275)  看这个，但这个q(k,l)和论文中不一样
## [关于 IMCRA+OMLSA 语音降噪算法的详细解释](https://blog.csdn.net/wangxunweihua/article/details/90259865)

## [IMCRA学习笔记 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/548265756)  看这个是准确的

实际上在频域加窗，w在程序中就是1，相当于频点和2 * 1+1=3，频点和3个数线性卷积，再舍去后两个

可以照着matlab程序理解更快

通过最小值估计噪声
先频域平滑估计的噪声，简单计算VAD 通过VAD再平滑更新估计噪声的功率 再时域平滑 用平滑后的计算语音先验不存在概率 计算先验 后验信噪比 计算语音存在概率 最后通过公式计算增益

[[OMLSA-IMCRA论文]]






